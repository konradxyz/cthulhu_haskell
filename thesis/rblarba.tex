%
% Niniejszy plik stanowi przyk³ad formatowania pracy magisterskiej na
% Wydziale MIM UW.  Szkielet u¿ytych poleceñ mo¿na wykorzystywaæ do
% woli, np. formatujac wlasna prace.
%
% Zawartosc merytoryczna stanowi oryginalnosiagniecie
% naukowosciowe Marcina Wolinskiego.  Wszelkie prawa zastrze¿one.
%
% Copyright (c) 2001 by Marcin Woliñski <M.Wolinski@gust.org.pl>
% Poprawki spowodowane zmianami przepisów - Marcin Szczuka, 1.10.2004
% Poprawki spowodowane zmianami przepisow i ujednolicenie 
% - Seweryn Kar³owicz, 05.05.2006
% dodaj opcjê [licencjacka] dla pracy licencjackiej
\documentclass{pracamgr}

\usepackage{polski}
\usepackage{xcolor}
\usepackage{listings}
\lstset { %
    language=C++,   
       basicstyle=\footnotesize,% basic font setting
}
%Jesli uzywasz kodowania polskich znakow ISO-8859-2 nastepna linia powinna byc 
%odkomentowana
\usepackage[latin2]{inputenc}
%Jesli uzywasz kodowania polskich znakow CP-1250 to ta linia powinna byc 
%odkomentowana
%\usepackage[cp1250]{inputenc}

% Dane magistranta:

\author{Konrad Paziewski}

\nralbumu{306410}

\title{Automatyczne zrównoleglanie programów w jêzykach czysto funkcyjnych}

\tytulang{Automatic parallelisation of pure functional programming languages}

%kierunek: Matematyka, Informatyka, ...
\kierunek{Informatyka}

% informatyka - nie okreslamy zakresu (opcja zakomentowana)
% matematyka - zakres moze pozostac nieokreslony,
% a jesli ma byc okreslony dla pracy mgr,
% to przyjmuje jedna z wartosci:
% {metod matematycznych w finansach}
% {metod matematycznych w ubezpieczeniach}
% {matematyki stosowanej}
% {nauczania matematyki}
% Dla pracy licencjackiej mamy natomiast
% mozliwosc wpisania takiej wartosci zakresu:
% {Jednoczesnych Studiow Ekonomiczno--Matematycznych}

% \zakres{Tu wpisac, jesli trzeba, jedna z opcji podanych wyzej}

% Praca wykonana pod kierunkiem:
% (podaæ tytu³/stopieñ imiê i nazwisko opiekuna
% Instytut
% ew. Wydzia³ ew. Uczelnia (je¿eli nie MIM UW))
\opiekun{dra hab. Marcina Benke\\
  Instytut Informatyki\\
  }

% miesi±c i~rok:
\date{Listopad 2015}

%Podaæ dziedzinê wg klasyfikacji Socrates-Erasmus:
\dziedzina{ 
%11.0 Matematyka, Informatyka:\\ 
%11.1 Matematyka\\ 
11.3 Informatyka\\
%11.4 Sztuczna inteligencja\\ 
%11.5 Nauki aktuarialne\\
%11.9 Inne nauki matematyczne i informatyczne
}

%Klasyfikacja tematyczna wedlug AMS (matematyka) lub ACM (informatyka)
\klasyfikacja{D. Software\\
  D.127. Blabalgorithms\\
  D.127.6. Numerical blabalysis}

% S³owa kluczowe:
\keywords{blabaliza ró¿nicowa, fetory $\sigma$-$\rho$, fooizm,
  blarbarucja, blaba, fetoryka, baleronik}

% Tu jest dobre miejsce na Twoje w³asne makra i~¶rodowiska:
\newtheorem{defi}{Definicja}[section]

% koniec definicji

\begin{document}
\maketitle

%tu idzie streszczenie na strone poczatkowa
\begin{abstract}
  W pracy przedstawiono jêzyk funckyjny Cthulhu i jego implementacjê
  pozwalaj±c± na automatyczne zrównoleglanie programów.
\end{abstract}

\tableofcontents
%\listoffigures
%\listoftables

\chapter*{Wprowadzenie}
\addcontentsline{toc}{chapter}{Wprowadzenie}

Prawo Moore'a od lat siedemdziesi±tych dwudziestego wieku dyktowa³o tempo wzrostu wydajno¶ci
uk³adów scalonych. Wyk³adniczy wzrost ilo¶ci tranzystorów na jednostkê powierzchni przy zachowaniu
sta³ej ceny pozwala³ zak³adaæ, ¿e czêstotliwo¶æ taktowania przeciêtnego procesora bêdzie rosn±æ
dwukrotnie co dwa lata. Niestety, w ostatnich latach tendencja ta zanika. Prawo Moore'a nadal
dzia³a w sferze miniaturyzacji elementów uk³adów scalonych. Jednak¿e, nie przek³ada siê to ju¿
na oczekiwany wzrost wydajno¶ci uk³adu. Czêstotliwo¶æ taktowania procesorów nie ro¶nie ju¿
wyk³adniczo.

Du¿o prostszym sposobem na zwiêkszenie teoretycznej mocy obliczeniowej procesora jest
zwiêkszenie liczby rdzeni. Mo¿liwo¶æ równoleg³ego wykonywania n w±tków obliczeñ
w teorii zwiêksza ilo¶æ operacji wykonywanych w jednostce czasu n-krotnie w stosunku
do uk³adu jednow±tkowego.
Uruchomienie kilku procesów wykorzystuj±cych wiele rdzeni procesora
jest proste. Nowoczesne systemy operacyjne zapewniaj± skuteczn± izolacjê miêdzy poszczególnymi
procesami. Taka architektura pozwala na efektywne równoleg³e wykonywanie niezale¿nych od siebie zadañ.
Niestety wykorzystanie wielu jednostek obliczeniowych procesora do wykonania jednego zadania nie jest zagadnieniem trywialnym.
Wymaga to podzia³u zadania na podzadania, rozdzielenia podzadan pomiêdzy poszczególne rdzenie,
a nastêpnie scalenia wyniku.
Niestety programy wspó³bie¿ne s± trudne do przygotowania, analizy i modyfikacji.
Czêsto kod odpowiedzialny za synchronizacjê i podzia³
pracy miêdzy poszczególne w±tki wykonania jest bardziej skomplikowany
ni¿ sama logika programu. Przyjrzyjmy siê nastêpuj±cym dwóm wersjom tej samej funkcji:

\begin{lstlisting}
template<typename A, typename B, typename F>
void map(F& f, std::vector<A>& input, std::vector<B>& output) {
    output.resize(input.size());
    for ( unsigned i = 0; i < input.size(); ++i ){
        output[i] = f(input[i]);
    }
}

template<typename A, typename B, typename F>
void map_par(F& f, std::vector<A>& input, std::vector<B>& output) {
  output.resize(input.size());
  std::vector<std::thread> threads;
  auto operation = [&input, &output, &f](int i) {
    output[i] = f(input[i]);
  };
  for ( unsigned i = 0; i < input.size(); ++i )
    threads.emplace_back(operation, i);
  for ( unsigned i = 0; i < threads.size(); ++i )
    threads[i].join();
}
\end{lstlisting}

Zauwa¿my, ¿e wiêkszo¶æ kodu drugiej z zademonstrowanych tu procedur odpowiada za zrównoleglenie
pracy. Co wiêcej, na pierwszy rzut oka ciê¿ko oceniæ jakie rzeczywi¶cie zadanie wykonuje ta funkcja.

Tego typu problemy czêsto sprawiaj± ¿e programi¶ci uciekaj± od pisania programów wielow±tkow

Wydajno¶æ 
Jednak¿e, pe³ne wykorzystanie 
\chapter{Podstawowe pojêcia}\label{r:pojecia}

Pojêciem pierwotnym blabalii fetorycznej jest \emph{blaba}.
Blabali¶ci nie podaj± jego definicji, mówi±c za Ciach-Pfe t-\=am
K\^un (fooistyczny mêdrzec, XIX w. p.n.e.):
\begin{quote}
  Blaba, który jest blaba, nie jest prawdziwym blaba.

\raggedleft\slshape t³um. z~chiñskiego Robert Blarbarucki
\end{quote}

\section{Definicje}

Oto dwie definicje wprowadzaj±ce podstawowe pojêcia blabalii
fetorycznej:

\begin{defi}\label{skupienie}
  Silny, zwarty i gotowy fetor bazowy nazwiemy \emph{skupieniem}.
\end{defi}

\begin{defi}\label{fetor}
  \emph{Fetorem} nazwiemy skupienie blaba spe³niaj±ce nastêpuj±cy
  \emph{aksjomat reperkusatywno¶ci}:
  $$\forall \mathcal{X}\in Z(t)\ \exists
  \pi\subseteq\oint_{\Omega^2}\kappa\leftrightarrow 42$$
\end{defi}


\section{Implementacja}

Teoretycy blabalii (zob. np. pracê~\cite{grglo}) zadowalaj± siê
niekonstruktywnym opisem natury fetorów.

Podstawowym narzêdziem blabalii empirycznej jest blabalizator
ró¿nicowy.  Przyrz±d ten pozwala w~sposób przybli¿ony uzyskaæ
wspó³czynniki rozk³adu G³ombaskiego dla fetorów bazowych
i~harmonicznych.  Praktyczne znaczenie tego procesu jest oczywiste:
korzystaj±c z~reperkusatywno¶ci pozwala on przej¶æ do przestrzeni
$\Lambda^{\nabla}$, a~tym samym znale¼æ retroizotonalne wspó³czynniki
semi-quasi-celibatu dla klatek Rozkoszy (zob.~\cite{JR}).

Klasyczne algorytmy dla blabalizatora ró¿nicowego wykorzystuj±:
\begin{enumerate}
\item dualizm falowo\dywiz korpuskularny, a w szczególno¶ci
  \begin{enumerate}
  \item korpuskularn± naturê fetorów,
  \item falow± naturê blaba,
  \item falowo\dywiz korpuskularn± naturê gryzmo³ów;
  \end{enumerate}
\item postêpuj±c± gryzmolizacjê poszczególnych dziedzin nauki, w
  szczególno¶ci badañ systemowych i rozcieñczonych;
\item dynamizm fazowy stetryczenia parajonizacyjnego;
\item wreszcie tradycyjne opozycje:
  \begin{itemize}
  \item duch --- bakteria,
  \item mieæ --- chcieæ,
  \item my¶l --- owsianka,
  \item parafina --- durszlak\footnote{Wiêcej o tym przypadku --- patrz
      prace Gryzybór\dywiz G³ombaskiego i innych teoretyków nurtu
      teoretyczno\dywiz praktycznego badañ w~Instytucie Podstawowych
      Problemów Blabalii w~Fifie.},
  \item logos --- termos%\footnote{Szpotañski}
  \end{itemize}
  z w³a¶ciwym im przedziwym dynamizmem.
\end{enumerate}

\begin{figure}[tp]
  \centering
  \framebox{\vbox to 4cm{\vfil\hbox to
      7cm{\hfil\tiny.\hfil}\vfil}}
  \caption{Artystyczna wizja blaba w~obrazie wêgierskiego artysty
    Josipa~A. Rozkoszy pt.~,,Blaba''}
\end{figure}

\chapter{Wcze¶niejsze implementacje blabalizatora
  ró¿nicowego}\label{r:losers}

\section{Podej¶cie wprost}

Najprostszym sposobem wykonania blabalizy jest si³owe przeszukanie
ca³ej przestrzeni rozwi±zañ.  Jednak, jak ³atwo wyliczyæ, rozmiar
przestrzeni rozwi±zañ ro¶nie wyk³adniczo z~liczb± fetorów bazowych.
Tak wiêc przegl±d wszystkich rozwi±zañ sprawdza siê jedynie dla bardzo
prostych przestrzeni lamblialnych.  Oznacza to, ¿e taka metoda ma
niewielkie znaczenie praktyczne --- w~typowym przypadku z~¿ycia trzeba
rozwa¿aæ przestrzenie lamblialne wymiaru rzêdu 1000.

W~literaturze mo¿na znale¼æ kilka prób opracowania heurystyk dla
problemu blabalizy (por. \cite{heu}).  Korzystaj±c z~heurystyk daje
siê z~pewnym trudem dokonaæ blabalizy w~przestrzeni o~np.~500 fetorach
bazowych.  Nale¿y jednak pamiêtaæ, ¿e heurystyka nie daje gwarancji
znalezienia najlepszego rozwi±zania.  Fifak w~pracy~\cite{ff-sr}
podaje, jak dla dowolnie zadanej funkcji oceniaj±cej skonstruowaæ
dane, dla których rozwi±zanie wygenerowane przez algorytm heurystyczny
jest dowolnie odleg³e od rzeczywistego.
\chapter{Idea}

Nale¿y zwróciæ uwagê ¿e cthulhu jest jêzykiem w pe³ni czystym.
Semantyka nie wyznacza ¿adnej szczególnej kolejno¶ci operacji,
nie zawiera te¿ pojêcia stanu. Oznacza to zatem, ¿e mamy 
dowolno¶æ co do wyboru wyra¿eñ które zostan± wykonane równolegle.

\chapter{Opis jêzyka}
\section{System typów}
Zbiór 

Cthulhu jest prostym jêzykiem funkcyjnym o ograniczonej liczbie dostêpnych konstrukcji.
Program sk³ada siê z listy definicji typów i funkcji.

Program w tym jêzyku modeluje funkcjê ze zbioru liczb naturalnych w zbior liczb naturalnych.
  

\chapter{Semantyka}
Proponowany jêzyk programowania jest pe³nowarto¶ciowym jêzykiem funkcyjnym.

\chapter{Implementacja}
Przygotowana przez mnie i opsywana w tym dokumencie realizacja jêzyka Cthulhu
sk³ada siê z dwóch czê¶ci. Pierwsz± z nich jest
napisany w Haskellu generator kodu. Jego zadaniem jest statyczna
analiza programu wej¶ciowego i wygenerowanie równowa¿nego programu w C++. 
Generator kodu sprawdza poprawno¶æ
kodu a tak¿e dba o optymalizacje oraz wybór wyra¿eñ które bêd±
obliczane równolegle. 
Drugim elementem jest przygotowane w C++
¶rodowisko uruchomieniowe. Fragmenty te s± po³±czone przez
pewnego rodzaju zbiór instrukcji przypominaj±cych ideowo
instrukcje asemblerowe.

\section{Asembler cthulhu}
\section{Generator kodu}

Zadaniem generatora kodu jest przygotowanie ci±gu instrukcji
które zostan± pó¼niej wykonane przez ¶rodowisko uruchomieniowe.
Proces przygotwania tych instrukcji sk³ada siê z czterech etapów:
\begin{itemize}
\item analiza leksykalno-sk³adniowa
\item analiza semantyczna
\item przygotowanie listy instrukcji
\item wygenerowanie pliku nag³ówkowego C++ zawieraj±cego instrukcje z poprzedniego kroku
\end{itemize}


\subsection{Analiza leksykalno-sk³adniowa}
Parser jêzyka jest generowany przy pomocy narzêdzia BNFC.
Automatycznie, na podstawie zadanej gramatyki generowane
s± modu³y odpowiedzialne za wszystkie tradycyjne etapy analizy
leksykalno-sk³adniowej - to znaczy lekser i parser. Wygenerowany
zostaje te¿ modu³ opisuj±cy strukturê bêd±c± typem wyniku parsowania.
\subsection{Analiza semantyczna}
Celem analizy semantycznej jest sprawdzenie poprawno¶ci programu
a tak¿e powi±zanie identyfikatorów z ich znaczeniem i typem.
Niestandardowe jest to ¿e nie jest kompilowany ca³y program
a jedynie te funkcje które s± osi±galne - byc mo¿e nie bezpo¶rednio
z funkcji g³ównej programu. Z drugiej strony typy i funkcje parametryzowane
kompilowane s± oddzielnie dla ka¿dej kombinacji parametrów.
\subsection{Przygotowanie listy instrukcji} 
W pierwszej fazie analizy generator
Co wiêcej, generator kodu musi wygenerowaæ
dodatkowe informacjê w celu umo¿
Przygotowana przeze mnie implementacja Cthulhu inicjalizuje
obliczenie równoleg³e tylko dla wyra¿eñ bêd±cych wywo³aniami
funkcji. Co wiêcej, jedyne funkcje które  

\section{¦rodowisko uruchomieniowe}
¦rodowisko uruchomieniowe 

\chapter{Dokumentacja u¿ytkowa i~opis implementacji}\label{r:impl}

Program przygotowany dla systemu operacyjnego M\$ Windows uruchamia
siê energicznym dwumlaskiem na jego ikonce w~folderze
\verb+\\FIDO\FOO\BLABA+.  Nastêpnie kolistym ruchem rêki nale¿y
naprowadziæ kursor na menu \texttt{Blabaliza} i~uaktywniæ pozycjê
\texttt{Otwórz plik}.  Po wybraniu pliku i~zatwierdzeniu wyboru
przyciskiem \texttt{OK} rozpocznie siê proces blabalizy.  Wyniki
zostan± zapisane w~pliku o~nazwie \texttt{99-1a.tx.43} w~bie¿±cym
folderze.

\chapter{Podsumowanie}

W~pracy przedstawiono pierwsz± efektywn± implementacjê blabalizatora
ró¿nicowego.  Umiejêtno¶æ wykonania blabalizy numerycznej dla danych
,,z ¿ycia'' stanowi dla blabalii fetorycznej podobny prze³om, jak dla
innych dziedzin wiedzy stanowi³o og³oszenie teorii Miko³aja Kopernika
i~Gryzybór G³ombaskiego.  Z~pewno¶ci± w~rozpocznynaj±cym siê XXI wieku
bêdziemy obserwowaæ rozkwit blabalii fetorycznej.

Trudno przewidzieæ wszystkie nowe mo¿liwo¶ci, ale te co bardziej
oczywiste mo¿na wskazaæ ju¿ teraz.  S± to:
\begin{itemize}
\item degryzmolizacja wieñców telecentrycznych,
\item realizacja zimnej reakcji lambliarnej,
\item loty celulityczne,
\item dok³adne obliczenie wieku Wszech¶wiata.
\end{itemize}

\section{Perspektywy wykorzystania w~przemy¶le}

Ze wzglêdu na znaczenie strategiczne wyników pracy ten punkt uleg³
utajnieniu.

\appendix

\chapter{G³ówna pêtla programu zapisana w~jêzyku T\=oFoo}

\begin{verbatim}
[[foo]{,}[[a3,(([(,),{[[]]}]),
  [1; [{,13},[[[11],11],231]]].
  [13;[!xz]].
  [42;[{,x},[[2],{'a'},14]]].
  [br;[XQ*10]].
 ), 2q, for, [1,]2, [..].[7]{x}],[(((,[[1{{123,},},;.112]],
        else 42;
   . 'b'.. '9', [[13141],{13414}], 11),
 [1; [[134,sigma],22]].
 [2; [[rho,-],11]].
 )[14].
 ), {1234}],]. [map [cc], 1, 22]. [rho x 1]. {22; [22]},
       dd.
 [11; sigma].
        ss.4.c.q.42.b.ll.ls.chmod.aux.rm.foo;
 [112.34; rho];
        001110101010101010101010101010101111101001@
 [22%f4].
 cq. rep. else 7;
 ]. hlt
\end{verbatim}

\chapter{Przyk³adowe dane wej¶ciowe algorytmu}

\begin{center}
  \begin{tabular}{rrr}
    $\alpha$ & $\beta$ & $\gamma_7$ \\
    901384 & 13784 & 1341\\
    68746546 & 13498& 09165\\
    918324719& 1789 & 1310 \\
    9089 & 91032874& 1873 \\
    1 & 9187 & 19032874193 \\
    90143 & 01938 & 0193284 \\
    309132 & $-1349$ & $-149089088$ \\
    0202122 & 1234132 & 918324098 \\
    11234 & $-109234$ & 1934 \\
  \end{tabular}
\end{center}

\chapter{Przyk³adowe wyniki blabalizy
    (ze~wspó³czynnikami~$\sigma$-$\rho$)}

\begin{center}
  \begin{tabular}{lrrrr}
    & Wspó³czynniki \\
    & G³ombaskiego & $\rho$ & $\sigma$ & $\sigma$-$\rho$\\
    $\gamma_{0}$ & 1,331 & 2,01 & 13,42 & 0,01 \\
    $\gamma_{1}$ & 1,331 & 113,01 & 13,42 & 0,01 \\
    $\gamma_{2}$ & 1,332 & 0,01 & 13,42 & 0,01 \\
    $\gamma_{3}$ & 1,331 & 51,01 & 13,42 & 0,01 \\
    $\gamma_{4}$ & 1,332 & 3165,01 & 13,42 & 0,01 \\
    $\gamma_{5}$ & 1,331 & 1,01 & 13,42 & 0,01 \\
    $\gamma_{6}$ & 1,330 & 0,01 & 13,42 & 0,01 \\
    $\gamma_{7}$ & 1,331 & 16435,01 & 13,42 & 0,01 \\
    $\gamma_{8}$ & 1,332 & 865336,01 & 13,42 & 0,01 \\
    $\gamma_{9}$ & 1,331 & 34,01 & 13,42 & 0,01 \\
    $\gamma_{10}$ & 1,332 & 7891432,01 & 13,42 & 0,01 \\
    $\gamma_{11}$ & 1,331 & 8913,01 & 13,42 & 0,01 \\
    $\gamma_{12}$ & 1,331 & 13,01 & 13,42 & 0,01 \\
    $\gamma_{13}$ & 1,334 & 789,01 & 13,42 & 0,01 \\
    $\gamma_{14}$ & 1,331 & 4897453,01 & 13,42 & 0,01 \\
    $\gamma_{15}$ & 1,329 & 783591,01 & 13,42 & 0,01 \\
  \end{tabular}
\end{center}

\begin{thebibliography}{99}
\addcontentsline{toc}{chapter}{Bibliografia}

\bibitem[Bea65]{beaman} Juliusz Beaman, \textit{Morbidity of the Jolly
    function}, Mathematica Absurdica, 117 (1965) 338--9.

\bibitem[Blar16]{eb1} Elizjusz Blarbarucki, \textit{O pewnych
    aspektach pewnych aspektów}, Astrolog Polski, Zeszyt 16, Warszawa
  1916.

\bibitem[Fif00]{ffgg} Filigran Fifak, Gizbert Gryzogrzechotalski,
  \textit{O blabalii fetorycznej}, Materia³y Konferencji Euroblabal
  2000.

\bibitem[Fif01]{ff-sr} Filigran Fifak, \textit{O fetorach
    $\sigma$-$\rho$}, Acta Fetorica, 2001.

\bibitem[G³omb04]{grglo} Gryzybór G³ombaski, \textit{Parazytonikacja
    blabiczna fetorów --- nowa teoria wszystkiego}, Warszawa 1904.

\bibitem[Hopp96]{hopp} Claude Hopper, \textit{On some $\Pi$-hedral
    surfaces in quasi-quasi space}, Omnius University Press, 1996.

\bibitem[Leuk00]{leuk} Lechoslav Leukocyt, \textit{Oval mappings ab ovo},
  Materia³y Bia³ostockiej Konferencji Hodowców Drobiu, 2000.

\bibitem[Rozk93]{JR} Josip A.~Rozkosza, \textit{O pewnych w³asno¶ciach
    pewnych funkcji}, Pó³nocnopomorski Dziennik Matematyczny 63491
  (1993).

\bibitem[Spy59]{spyrpt} Mrowclaw Spyrpt, \textit{A matrix is a matrix
    is a matrix}, Mat. Zburp., 91 (1959) 28--35.

\bibitem[Sri64]{srinis} Rajagopalachari Sriniswamiramanathan,
  \textit{Some expansions on the Flausgloten Theorem on locally
    congested lutches}, J. Math.  Soc., North Bombay, 13 (1964) 72--6.

\bibitem[Whi25]{russell} Alfred N. Whitehead, Bertrand Russell,
  \textit{Principia Mathematica}, Cambridge University Press, 1925.

\bibitem[Zen69]{heu} Zenon Zenon, \textit{U¿yteczne heurystyki
    w~blabalizie}, M³ody Technik, nr~11, 1969.

\end{thebibliography}

\end{document}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% coding: latin-2
%%% End:
